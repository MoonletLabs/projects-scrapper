version: '3.8'

services:
  scraper:
    build: .
    container_name: cryptorank-scraper
    environment:
      - BROWSERLESS_URL=${BROWSERLESS_URL:-wss://browserless.tiexo.com/}
      - API_KEY=${API_KEY:-your-api-key-here}
    volumes:
      - /root/scrapper-data/output:/app/output
      - /root/scrapper-data/screenshots:/app/screenshots
    restart: unless-stopped

  scheduler:
    image: docker:27-cli
    container_name: cryptorank-scheduler
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./crontab:/etc/crontabs/root:ro
    command: ["crond", "-f", "-l", "2"]
    restart: unless-stopped
    depends_on:
      - scraper

  web:
    image: nginx:alpine
    container_name: cryptorank-web
    ports:
      - "80:80"
    volumes:
      - /root/scrapper-data/output:/usr/share/nginx/html/data:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
